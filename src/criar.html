<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoveON - Criar</title>

    <!-- Estilos -->
    <link rel="stylesheet" href="../src/css/Josh.Reset/Reset.css">
    <link rel="stylesheet" href="css/criar.css">

    <!-- Fonte -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Khand:wght@300;400;500;600;700&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="../img/logos/favicon.ico" type="image/x-icon">

    <!-- Ícones -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>
    <!-- Menu -->
    
    <div class="menu">
        <img src="../img/logos/logo.png" alt="Logo" class="logo">
        <ul class="menu-list">
            <li><a href="../index.html"><ion-icon name="home-outline" class="icon"></ion-icon>Página Inicial</a></li>
            <li><a href="../src/criar.html"><ion-icon name="create-outline" class="icon"></ion-icon>Criar</a></li>
            <li><a href="../src/amigos.html"><ion-icon name="chatbubbles-outline" class="icon"></ion-icon>Mensagens</a></li>
            <li><a href="../src/comunidade.html"><ion-icon name="people-outline" class="icon"></ion-icon>Comunidades</a></li>
            <li><a href="../src/notificacoes.html"><ion-icon name="notifications-outline" class="icon"></ion-icon>Notificações</a></li>
            <li><a href="../src/meu_perfil.html"><ion-icon name="person-circle-outline" class="icon"></ion-icon>Meu Perfil</a></li>
        </ul>
    </div>
    <div class="separador "></div>

    <!-- Menu Responsivo -->

    <div class="menu-responsivo">
        <ul class="menu-list-responsivo">
            <li><a href="../index.html"><ion-icon name="home-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/criar.html"><ion-icon name="create-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/amigos.html"><ion-icon name="chatbubbles-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/comunidade.html"><ion-icon name="people-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/notificacoes.html"><ion-icon name="notifications-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/meu_perfil.html"><ion-icon name="person-circle-outline" class="icon"></ion-icon></a></li>
        </ul>
    </div>

    <div class="main-content">
    <main class="container-postagem">
    <div class="h1-text">
        <h1>Publique Fotos/Vídeos ou Textos</h1>
    </div>

    <!-- Upload de imagem -->
    <label for="image-upload" class="image-upload-container" tabindex="0">
        <input type="file" id="image-upload" class="hidden" accept="image/*">
        <div class="upload-preview" id="upload-preview">
            <ion-icon name="cloud-upload-outline" class="icon-upload"></ion-icon>
        </div>
        <span class="text-upload">Clique ou toque para selecionar uma imagem</span>
    </label>

    <!-- Caixa de texto -->
    <textarea placeholder="Escreva algo para sua publicação..." aria-label="Texto da publicação"></textarea>

    <!-- Botão de postagem -->
    <div class="button-container">
        <button type="button" id="postar-btn">
            <ion-icon name="send-outline" style="vertical-align: middle; margin-right: 7px;"></ion-icon>POSTAR
        </button>
    </div>
</main>
</div>

<script>
  document.getElementById('image-upload').addEventListener('change', function(event) {
      const preview = document.getElementById('upload-preview');
      preview.innerHTML = '';
      if (event.target.files && event.target.files[0]) {
          const img = document.createElement('img');
          img.src = URL.createObjectURL(event.target.files[0]);
          img.className = 'preview-img';
          img.onload = () => URL.revokeObjectURL(img.src);
          preview.appendChild(img);
      } else {
          preview.innerHTML = '<ion-icon name="cloud-upload-outline" class="icon-upload"></ion-icon>';
      }
  });

  document.getElementById('postar-btn').addEventListener('click', async () => {
      const usuario_id = localStorage.getItem('usuario_id');
      const conteudo = document.querySelector('textarea').value.trim();
      const imagem = document.getElementById('image-upload').files[0];

      if (!usuario_id) {
          alert('Usuário não autenticado. Faça login novamente.');
          return;
      }

      if (!conteudo && !imagem) {
          alert('Escreva algo ou selecione uma imagem para postar!');
          return;
      }

      const formData = new FormData();
      formData.append('usuario_id', usuario_id);
      formData.append('conteudo', conteudo);
      if (imagem) {
          formData.append('imagem', imagem);
      }

      try {
          const response = await fetch('http://localhost:3000/api/postagens', {
              method: 'POST',
              body: formData
          });

          if (!response.ok) {
              throw new Error('Erro ao criar a postagem');
          }

          const resultado = await response.json();
          alert('Postagem criada com sucesso!');
      } catch (error) {
          console.error(error);
          alert('Erro ao enviar a postagem.');
      }
  });
</script>
</body>
</html>
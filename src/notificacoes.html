<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <title>MoveON - Notificações</title>

    <!-- CSS -->
    <link rel="stylesheet" href="../src/css/notificacoes.css" />
    <link rel="stylesheet" href="../src/css/style.css" />
    <link rel="stylesheet" href="../src/css/Josh.Reset/Reset.css" />
    <link href="../src/css/output.css" rel="stylesheet" />

    <!-- Favicon -->
    <link rel="icon" href="../img/logos/favicon.ico" type="image/x-icon" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Khand:wght@300;400;500;600;700&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" />

    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>

    <!-- Menu -->
    <div class="menu">
        <img src="../img/logos/logo.png" alt="Logo" class="logo" />
        <ul class="menu-list">
            <li><a href="../index.html"><ion-icon name="home-outline" class="icon"></ion-icon>Página Inicial</a></li>
            <li><a href="../src/criar.html"><ion-icon name="create-outline" class="icon"></ion-icon>Criar</a></li>
            <li><a href="../src/amigos.html"><ion-icon name="chatbubbles-outline" class="icon"></ion-icon>Mensagens</a></li>
            <li><a href="../src/comunidade.html"><ion-icon name="people-outline" class="icon"></ion-icon>Comunidades</a></li>
            <li><a href="../src/notificacoes.html"><ion-icon name="notifications-outline" class="icon"></ion-icon>Notificações</a></li>
            <li><a href="../src/meu_perfil.html"><ion-icon name="person-circle-outline" class="icon"></ion-icon>Meu Perfil</a></li>
        </ul>
    </div>
    <div class="separador"></div>

    <!-- Menu Responsivo -->
    <div class="menu-responsivo">
        <ul class="menu-list-responsivo">
            <li><a href="../index.html"><ion-icon name="home-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/criar.html"><ion-icon name="create-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/amigos.html"><ion-icon name="chatbubbles-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/comunidade.html"><ion-icon name="people-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/notificacoes.html"><ion-icon name="notifications-outline" class="icon"></ion-icon></a></li>
            <li><a href="../src/meu_perfil.html"><ion-icon name="person-circle-outline" class="icon"></ion-icon></a></li>
        </ul>
    </div>

    <!-- Notificações -->
    <div class="notificacao-container">
        <h1>Notificações</h1>
        
        <div id="notificacoes-lista">
            <!-- Notificações inseridas pelo JavaScript -->
        </div>
    </div>

    <script type="module">
        async function carregarNotificacoes() {
            const lista = document.getElementById('notificacoes-lista');
            if (!lista) {
                console.error('Elemento #notificacoes-lista não encontrado no HTML');
                return;
            }

            lista.innerHTML = 'Carregando notificações...';

            try {
                const usuarioId = localStorage.getItem('usuario_id');
                if (!usuarioId) {
                    lista.innerHTML = '<p>Faça login para ver notificações.</p>';
                    return;
                }

                const resposta = await fetch(`http://localhost:3000/api/notificacoes/${usuarioId}`);

                if (!resposta.ok) throw new Error('Erro ao buscar notificações');

                const notificacoes = await resposta.json();

                if (notificacoes.length === 0) {
                    lista.innerHTML = '<p>Sem notificações.</p>';
                    return;
                }

                lista.innerHTML = '';

                notificacoes.forEach(n => {
                    const dataFormatada = new Date(n.criado_em).toLocaleString();
                    const remetente = n.remetente?.nome || '';

                    const item = document.createElement('div');
                    item.classList.add('notificacao');

                    item.innerHTML = `
                        <div>
                            <ion-icon name="notifications-outline"></ion-icon>
                        </div>
                        <p>${n.mensagem}</p>
                        <small>${dataFormatada}</small>
                    `;

                    lista.appendChild(item);
                });

            } catch (erro) {
                console.error('Erro ao carregar notificações:', erro);
                lista.innerHTML = '<p>Erro ao carregar notificações.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            carregarNotificacoes();
        });
    </script>
</body>
</html>